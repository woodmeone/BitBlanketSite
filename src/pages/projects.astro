---
import BaseLayout from '../layouts/BaseLayout.astro';
import CollageCard from '../components/collage/CollageCard.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');

const categories = [
  { id: 'all', label: '全部' },
  { id: 'ai-tool', label: 'AI工具' },
  { id: 'saas', label: 'SaaS' },
  { id: 'open-source', label: '开源项目' },
  { id: 'api', label: 'API服务' },
];

const pricingLabels: Record<string, string> = {
  free: '免费',
  freemium: '免费增值',
  paid: '付费',
  subscription: '订阅',
};
---

<BaseLayout title="AI项目">
  <div class="space-y-8">
    <section class="text-center py-8">
      <CollageCard rotation={-0.5} class="inline-block px-8 py-4">
        <h1 class="text-3xl md:text-4xl font-bold">AI项目导航</h1>
      </CollageCard>
      <p class="text-muted-foreground mt-4 max-w-2xl mx-auto">
        发现优质AI工具和项目，助力你的开发之旅
      </p>
    </section>

    <section class="flex flex-wrap gap-2 justify-center">
      {categories.map((cat, index) => (
        <button class:list={['nav-item', index === 0 ? 'nav-item-active' : 'nav-item-inactive']}>
          {cat.label}
        </button>
      ))}
    </section>

    <section class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      {projects.map((project, index) => {
        const rotation = ((index % 3) - 1) * 0.8;
        return (
          <a href={project.data.url} target="_blank" rel="noopener noreferrer">
            <CollageCard rotation={rotation} class:list={['p-6 h-full cursor-pointer', project.data.featured && 'border-accent/50']}>
              <div class="flex items-start justify-between mb-3">
                <h2 class="text-xl font-bold">{project.data.name}</h2>
                {project.data.featured && (
                  <span class="px-2 py-1 text-xs bg-accent text-accent-foreground">精选</span>
                )}
              </div>
              <p class="text-muted-foreground text-sm mb-4">{project.data.description}</p>
              <div class="flex items-center justify-between text-xs">
                <span class="px-2 py-0.5 bg-secondary">{pricingLabels[project.data.pricing]}</span>
                <span class="text-muted-foreground flex items-center gap-1">
                  访问
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </span>
              </div>
            </CollageCard>
          </a>
        );
      })}
    </section>

    <CollageCard rotation={0.5} class="p-6 text-center bg-accent text-accent-foreground">
      <h2 class="text-xl font-bold mb-2">想要推荐你的项目？</h2>
      <p class="text-accent-foreground/90 mb-4">
        欢迎提交优质AI项目，一起构建更好的开发者社区
      </p>
      <a href="/community">
        <span class="inline-block px-4 py-2 bg-secondary text-secondary-foreground border-2 border-primary/30">
          提交项目
        </span>
      </a>
    </CollageCard>
  </div>
</BaseLayout>
