---
import BaseLayout from '../layouts/BaseLayout.astro';
import CollageCard from '../components/collage/CollageCard.astro';
import { getCollection } from 'astro:content';

const software = await getCollection('software');

const platforms = [
  { id: 'all', label: 'å…¨éƒ¨å¹³å°' },
  { id: 'windows', label: 'Windows' },
  { id: 'mac', label: 'macOS' },
  { id: 'linux', label: 'Linux' },
  { id: 'web', label: 'Web' },
];

const platformIcons: Record<string, string> = {
  windows: 'ğŸªŸ',
  mac: 'ğŸ',
  linux: 'ğŸ§',
  web: 'ğŸŒ',
};
---

<BaseLayout title="è½¯ä»¶åˆ†äº«">
  <div class="space-y-8">
    <section class="text-center py-8">
      <CollageCard rotation={-0.5} class="inline-block px-8 py-4">
        <h1 class="text-3xl md:text-4xl font-bold">è½¯ä»¶åˆ†äº«</h1>
      </CollageCard>
      <p class="text-muted-foreground mt-4 max-w-2xl mx-auto">
        ç²¾é€‰å®ç”¨è½¯ä»¶å·¥å…·ï¼Œæå‡ä½ çš„å·¥ä½œæ•ˆç‡
      </p>
    </section>

    <section class="flex flex-wrap gap-2 justify-center">
      {platforms.map((platform, index) => (
        <button class:list={['nav-item', index === 0 ? 'nav-item-active' : 'nav-item-inactive']}>
          {platform.label}
        </button>
      ))}
    </section>

    <section class="grid md:grid-cols-2 gap-6">
      {software.map((item, index) => {
        const rotation = ((index % 2) - 0.5) * 1.2;
        return (
          <CollageCard rotation={rotation} class="p-6 cursor-pointer">
            <div class="flex items-start justify-between mb-3">
              <div>
                <h2 class="text-xl font-bold">{item.data.name}</h2>
                <span class="text-xs text-muted-foreground">v{item.data.version}</span>
              </div>
              <div class="flex gap-1">
                {item.data.platform.map((p) => (
                  <span class="text-lg" title={p}>{platformIcons[p]}</span>
                ))}
              </div>
            </div>
            <p class="text-muted-foreground text-sm mb-4">{item.data.description}</p>
            <div class="flex items-center justify-between">
              <span class="text-xs text-muted-foreground">
                {item.data.category === 'development' ? 'å¼€å‘å·¥å…·' :
                 item.data.category === 'utility' ? 'æ•ˆç‡å·¥å…·' :
                 item.data.category === 'design' ? 'è®¾è®¡å·¥å…·' : 'åª’ä½“å·¥å…·'}
              </span>
              {item.data.downloadUrl && (
                <a href={item.data.downloadUrl} target="_blank" rel="noopener noreferrer">
                  <button class="nav-item nav-item-active text-sm px-3 py-1">
                    ä¸‹è½½
                  </button>
                </a>
              )}
              {item.data.websiteUrl && !item.data.downloadUrl && (
                <a href={item.data.websiteUrl} target="_blank" rel="noopener noreferrer">
                  <button class="nav-item nav-item-inactive text-sm px-3 py-1">
                    è®¿é—®
                  </button>
                </a>
              )}
            </div>
          </CollageCard>
        );
      })}
    </section>

    <CollageCard rotation={-0.3} class="p-6">
      <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
        <div class="w-2 h-6 bg-accent" />
        åˆ†ç±»æµè§ˆ
      </h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
        <div class="p-4 border-2 border-primary/20 cursor-pointer hover:border-primary/40 transition-colors">
          <div class="text-2xl mb-2">ğŸ’»</div>
          <p class="font-medium">å¼€å‘å·¥å…·</p>
          <p class="text-xs text-muted-foreground">{software.filter(s => s.data.category === 'development').length} æ¬¾</p>
        </div>
        <div class="p-4 border-2 border-primary/20 cursor-pointer hover:border-primary/40 transition-colors">
          <div class="text-2xl mb-2">âš¡</div>
          <p class="font-medium">æ•ˆç‡å·¥å…·</p>
          <p class="text-xs text-muted-foreground">{software.filter(s => s.data.category === 'utility').length} æ¬¾</p>
        </div>
        <div class="p-4 border-2 border-primary/20 cursor-pointer hover:border-primary/40 transition-colors">
          <div class="text-2xl mb-2">ğŸ¨</div>
          <p class="font-medium">è®¾è®¡å·¥å…·</p>
          <p class="text-xs text-muted-foreground">{software.filter(s => s.data.category === 'design').length} æ¬¾</p>
        </div>
        <div class="p-4 border-2 border-primary/20 cursor-pointer hover:border-primary/40 transition-colors">
          <div class="text-2xl mb-2">ğŸ¬</div>
          <p class="font-medium">åª’ä½“å·¥å…·</p>
          <p class="text-xs text-muted-foreground">{software.filter(s => s.data.category === 'media').length} æ¬¾</p>
        </div>
      </div>
    </CollageCard>
  </div>
</BaseLayout>
